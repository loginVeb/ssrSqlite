// –•—É–∫ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∑–æ–Ω –Ω–∞ –∫–∞—Ä—Ç–µ
// –ü–æ–∑–≤–æ–ª—è–µ—Ç –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≥–µ–æ–º–µ—Ç—Ä–∏–∏ –∑–æ–Ω
// –í–∫–ª—é—á–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —Ä–∞—Å—Ç—è–≥–∏–≤–∞–Ω–∏—è –∑–æ–Ω –∑–∞ —É–≥–ª–æ–≤—ã–µ —Ç–æ—á–∫–∏

// –ò–º–ø–æ—Ä—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö —Ö—É–∫–æ–≤ –∏–∑ React
import { useState, useEffect } from "react";
// –ò–º–ø–æ—Ä—Ç —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∑–æ–Ω –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
import { saveZonesToDB } from "../api";

// –≠–∫—Å–ø–æ—Ä—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ —Ö—É–∫–∞ useEditZoneLogic –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∑–æ–Ω
// –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
// - mapInstance: ref –Ω–∞ —ç–∫–∑–µ–º–ø–ª—è—Ä –∫–∞—Ä—Ç—ã MapLibre
// - drawInstance: ref –Ω–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —Ä–∏—Å–æ–≤–∞–Ω–∏—è Mapbox Draw
// - zones: –º–∞—Å—Å–∏–≤ —Ç–µ–∫—É—â–∏—Ö –∑–æ–Ω
// - setZones: —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –∑–æ–Ω
export function useEditZoneLogic(mapInstance, drawInstance, zones, setZones) {
  // –°–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
  // true - —Ä–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∞–∫—Ç–∏–≤–µ–Ω, false - –Ω–µ–∞–∫—Ç–∏–≤–µ–Ω
  const [isEditing, setIsEditing] = useState(false);

  // –≠—Ñ—Ñ–µ–∫—Ç –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–µ–∂–∏–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è isEditing
  useEffect(() => {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –∫–∞—Ä—Ç—ã –∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ —Ä–∏—Å–æ–≤–∞–Ω–∏—è
    if (!mapInstance.current || !drawInstance.current) return;

    if (isEditing) {
      // –í —Ä–µ–∂–∏–º–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –ø—Ä–æ—Å—Ç–æ–π —Ä–µ–∂–∏–º –≤—ã–±–æ—Ä–∞
      // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω —Å–Ω–∞—á–∞–ª–∞ –≤—ã–±—Ä–∞—Ç—å –∑–æ–Ω—É –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
      drawInstance.current.changeMode('simple_select');
      
      // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —Ä–∏—Å–æ–≤–∞–Ω–∏—è –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Ä–∞—Å—Ç—è–≥–∏–≤–∞–Ω–∏—è —É–≥–ª–æ–≤—ã—Ö —Ç–æ—á–µ–∫
      // –í–∫–ª—é—á–∞–µ–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –≤–µ—Ä—à–∏–Ω –ø–æ–ª–∏–≥–æ–Ω–æ–≤
      if (drawInstance.current.options) {
        drawInstance.current.options = {
          ...drawInstance.current.options,
          displayControlsDefault: false,
          userProperties: true,
          modes: {
            ...drawInstance.current.options.modes,
            direct_select: {
              ...drawInstance.current.options.modes?.direct_select,
              // –†–∞–∑—Ä–µ—à–∞–µ–º –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –≤–µ—Ä—à–∏–Ω –¥–ª—è —Ä–∞—Å—Ç—è–≥–∏–≤–∞–Ω–∏—è —É–≥–ª–æ–≤—ã—Ö —Ç–æ—á–µ–∫
              dragVertex: true,
              dragFeature: true
            }
          }
        };
      }
      
      // –õ–æ–≥–∏—Ä—É–µ–º –∞–∫—Ç–∏–≤–∞—Ü–∏—é —Ä–µ–∂–∏–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
      console.log('‚úÖ –†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∑–æ–Ω –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω - –≤—ã–±–µ—Ä–∏—Ç–µ –∑–æ–Ω—É –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è');
      console.log('üìå –¢–µ–ø–µ—Ä—å –¥–æ—Å—Ç—É–ø–Ω–æ —Ä–∞—Å—Ç—è–≥–∏–≤–∞–Ω–∏–µ –∑–æ–Ω –∑–∞ —É–≥–ª–æ–≤—ã–µ —Ç–æ—á–∫–∏');
    } else {
      // –î–µ–∞–∫—Ç–∏–≤–∏—Ä—É–µ–º —Ä–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –≤ –ø—Ä–æ—Å—Ç–æ–π —Ä–µ–∂–∏–º
      drawInstance.current.changeMode('simple_select');
      
      // –õ–æ–≥–∏—Ä—É–µ–º –¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—é —Ä–µ–∂–∏–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
      console.log('‚ùå –†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∑–æ–Ω –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω');
    }
  }, [isEditing, mapInstance, drawInstance]);

  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ä–µ–∂–∏–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
  // –ò–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ isEditing
  const toggleEditMode = () => {
    setIsEditing(prev => !prev);
  };

  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∑–æ–Ω –ø–æ—Å–ª–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
  const autoSaveZones = async () => {
    try {
      if (!drawInstance.current) return;
      
      const updatedZones = drawInstance.current.getAll().features;
      console.log('üíæ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∑–æ–Ω –ø–æ—Å–ª–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:', updatedZones.length);
      
      // –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –∑–æ–Ω—ã –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ useSaveHandlers)
      const zonesToSave = updatedZones.map(feature => {
        const zone = {
          ...feature,
          properties: {
            ...feature.properties,
            id: feature.properties?.id && feature.properties.id > 0 ? feature.properties.id : undefined
          }
        };
        return zone;
      });
      
      // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∑–æ–Ω—ã –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
      const result = await saveZonesToDB(zonesToSave);
      
      if (result.success && result.zones) {
        console.log('‚úÖ –ó–æ–Ω—ã —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –ø–æ—Å–ª–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è');
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å –Ω–æ–≤—ã–º–∏ ID
        const updatedZonesWithIds = result.zones.map(zone => {
          const parsedGeojson = JSON.parse(zone.geojson);
          parsedGeojson.properties = {
            ...parsedGeojson.properties,
            id: zone.id
          };
          return parsedGeojson;
        });
        
        setZones(updatedZonesWithIds);
        
        // –û–±–Ω–æ–≤–ª—è–µ–º drawInstance —Å –Ω–æ–≤—ã–º–∏ ID
        if (drawInstance.current && updatedZonesWithIds.length > 0) {
          const geojson = {
            type: "FeatureCollection",
            features: updatedZonesWithIds
          };
          drawInstance.current.set(geojson);
        }
      }
    } catch (error) {
      console.error('‚ùå –û—à–∏–±–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∑–æ–Ω:', error);
    }
  };

  // –≠—Ñ—Ñ–µ–∫—Ç –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–±—ã—Ç–∏–π –≤—ã–±–æ—Ä–∞ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∑–æ–Ω –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏
  useEffect(() => {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –∫–∞—Ä—Ç—ã –∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ —Ä–∏—Å–æ–≤–∞–Ω–∏—è
    if (!mapInstance.current || !drawInstance.current) return;

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è –≤—ã–±–æ—Ä–∞ –∑–æ–Ω—ã
    const handleSelection = (e) => {
      if (isEditing && e.features && e.features.length > 0) {
        // –ï—Å–ª–∏ –º—ã –≤ —Ä–µ–∂–∏–º–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –≤—ã–±—Ä–∞–Ω–∞ –∑–æ–Ω–∞, –ø–µ—Ä–µ—Ö–æ–¥–∏–º –≤ —Ä–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        const featureId = e.features[0].id;
        drawInstance.current.changeMode('direct_select', { featureId });
        console.log('‚úèÔ∏è –†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω –¥–ª—è –∑–æ–Ω—ã:', featureId);
      }
    };

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≥–µ–æ–º–µ—Ç—Ä–∏–∏ –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏
    const handleUpdate = (e) => {
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º —Ä–∞—Å—Ç—è–≥–∏–≤–∞–Ω–∏—è —É–≥–ª–æ–≤–æ–π —Ç–æ—á–∫–∏
      // –ü—Ä–∏ —Ä–∞—Å—Ç—è–≥–∏–≤–∞–Ω–∏–∏ —É–≥–ª–æ–≤—ã—Ö —Ç–æ—á–µ–∫ –≤ —Ä–µ–∂–∏–º–µ direct_select —Å–æ–∑–¥–∞–µ—Ç—Å—è —Å–æ–±—ã—Ç–∏–µ update
      const isCornerDrag = e.features && e.features.length > 0 && 
                          e.features[0].properties && 
                          e.features[0].properties.active === 'true';
      
      // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ —Ç–µ–∫—É—â–∏–µ –∑–æ–Ω—ã –∏–∑ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ —Ä–∏—Å–æ–≤–∞–Ω–∏—è
      const currentZones = drawInstance.current.getAll().features;
      
      // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∑–æ–Ω –≤ React
      // –≠—Ç–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ React —Å —Ç–µ–∫—É—â–∏–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –Ω–∞ –∫–∞—Ä—Ç–µ
      setZones(currentZones);
      
      if (isCornerDrag) {
        // –õ–æ–≥–∏—Ä—É–µ–º —Ä–∞—Å—Ç—è–≥–∏–≤–∞–Ω–∏–µ —É–≥–ª–æ–≤–æ–π —Ç–æ—á–∫–∏
        console.log('üî≤ –†–∞—Å—Ç—è–≥–∏–≤–∞–Ω–∏–µ —É–≥–ª–æ–≤–æ–π —Ç–æ—á–∫–∏ –∑–æ–Ω—ã:', e.features[0]?.properties?.id);
      } else {
        // –õ–æ–≥–∏—Ä—É–µ–º –æ–±—ã—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–æ–Ω—ã
        console.log('üîÑ –ó–æ–Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞:', e.features[0]?.properties?.id);
      }
      
      // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ—Å–ª–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
      setTimeout(() => {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —Ä–∏—Å–æ–≤–∞–Ω–∏—è –≤—Å–µ –µ—â–µ –¥–æ—Å—Ç—É–ø–µ–Ω
        if (drawInstance.current) {
          autoSaveZones();
        }
      }, 1000); // –ó–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è —á–∞—Å—Ç—ã—Ö —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–π
    };

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –≤–µ—Ä—à–∏–Ω (—Ä–∞—Å—Ç—è–≥–∏–≤–∞–Ω–∏—è —É–≥–ª–æ–≤—ã—Ö —Ç–æ—á–µ–∫)
    const handleVertexDrag = (e) => {
      // –≠—Ç–æ —Å–æ–±—ã—Ç–∏–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø—Ä–∏ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–∏ –≤–µ—Ä—à–∏–Ω –ø–æ–ª–∏–≥–æ–Ω–æ–≤
      if (e.features && e.features.length > 0) {
        console.log('üìå –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –≤–µ—Ä—à–∏–Ω—ã –∑–æ–Ω—ã:', e.features[0]?.properties?.id);
        
        // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ —Ç–µ–∫—É—â–∏–µ –∑–æ–Ω—ã –∏–∑ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ —Ä–∏—Å–æ–≤–∞–Ω–∏—è
        const currentZones = drawInstance.current.getAll().features;
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∑–æ–Ω –≤ React
        setZones(currentZones);
      }
    };

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (–≤–æ–∑–≤—Ä–∞—Ç –≤ —Ä–µ–∂–∏–º –≤—ã–±–æ—Ä–∞)
    const handleModeChange = (e) => {
      if (e.mode === 'simple_select' && isEditing) {
        console.log('‚úÖ –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ, –≤–æ–∑–≤—Ä–∞—Ç –≤ —Ä–µ–∂–∏–º –≤—ã–±–æ—Ä–∞');
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ –∏–∑ —Ä–µ–∂–∏–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        autoSaveZones();
      }
    };

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Å—ã–ª–∫–∏ –Ω–∞ —Ç–µ–∫—É—â–∏–µ —ç–∫–∑–µ–º–ø–ª—è—Ä—ã –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ cleanup —Ñ—É–Ω–∫—Ü–∏–∏
    const currentMapInstance = mapInstance.current;
    const currentDrawInstance = drawInstance.current;

    // –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ —Å–æ–±—ã—Ç–∏—è –≤—ã–±–æ—Ä–∞, –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è, –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –≤–µ—Ä—à–∏–Ω –∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–µ–∂–∏–º–∞
    currentMapInstance.on("draw.selectionchange", handleSelection);
    currentMapInstance.on("draw.update", handleUpdate);
    currentMapInstance.on("draw.vertex.drag", handleVertexDrag);
    currentMapInstance.on("draw.modechange", handleModeChange);

    // –§—É–Ω–∫—Ü–∏—è –æ—á–∏—Å—Ç–∫–∏: –æ—Ç–ø–∏—Å—ã–≤–∞–µ–º—Å—è –æ—Ç —Å–æ–±—ã—Ç–∏–π –ø—Ä–∏ —Ä–∞–∑–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
    return () => {
      if (currentMapInstance) {
        currentMapInstance.off("draw.selectionchange", handleSelection);
        currentMapInstance.off("draw.update", handleUpdate);
        currentMapInstance.off("draw.vertex.drag", handleVertexDrag);
        currentMapInstance.off("draw.modechange", handleModeChange);
      }
    };
  }, [mapInstance, drawInstance, setZones, isEditing, autoSaveZones]);

  // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º
  return {
    isEditing, // –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ä–µ–∂–∏–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    toggleEditMode, // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ä–µ–∂–∏–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    setIsEditing, // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä—è–º–æ–≥–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    autoSaveZones // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∑–æ–Ω
  };
}
